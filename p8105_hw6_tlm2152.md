P8105 Homework 6
================
Tucker Morgan (tlm2152)
12/4/2021

``` r
library(tidyverse)
library(modelr)
```

## Problem 1

``` r
birthweight_df <- read_csv("./Data/birthweight.csv")
```

    ## Rows: 4342 Columns: 20

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
str(birthweight_df)
```

    ## spec_tbl_df [4,342 × 20] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
    ##  $ babysex : num [1:4342] 2 1 2 1 2 1 2 2 1 1 ...
    ##  $ bhead   : num [1:4342] 34 34 36 34 34 33 33 33 36 33 ...
    ##  $ blength : num [1:4342] 51 48 50 52 52 52 46 49 52 50 ...
    ##  $ bwt     : num [1:4342] 3629 3062 3345 3062 3374 ...
    ##  $ delwt   : num [1:4342] 177 156 148 157 156 129 126 140 146 169 ...
    ##  $ fincome : num [1:4342] 35 65 85 55 5 55 96 5 85 75 ...
    ##  $ frace   : num [1:4342] 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ gaweeks : num [1:4342] 39.9 25.9 39.9 40 41.6 ...
    ##  $ malform : num [1:4342] 0 0 0 0 0 0 0 0 0 0 ...
    ##  $ menarche: num [1:4342] 13 14 12 14 13 12 14 12 11 12 ...
    ##  $ mheight : num [1:4342] 63 65 64 64 66 66 72 62 61 64 ...
    ##  $ momage  : num [1:4342] 36 25 29 18 20 23 29 19 13 19 ...
    ##  $ mrace   : num [1:4342] 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ parity  : num [1:4342] 3 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumlbw : num [1:4342] 0 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumsga : num [1:4342] 0 0 0 0 0 0 0 0 0 0 ...
    ##  $ ppbmi   : num [1:4342] 26.3 21.3 23.6 21.8 21 ...
    ##  $ ppwt    : num [1:4342] 148 128 137 127 130 115 105 119 105 145 ...
    ##  $ smoken  : num [1:4342] 0 0 1 10 1 0 0 0 0 4 ...
    ##  $ wtgain  : num [1:4342] 29 28 11 30 26 14 21 21 41 24 ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   babysex = col_double(),
    ##   ..   bhead = col_double(),
    ##   ..   blength = col_double(),
    ##   ..   bwt = col_double(),
    ##   ..   delwt = col_double(),
    ##   ..   fincome = col_double(),
    ##   ..   frace = col_double(),
    ##   ..   gaweeks = col_double(),
    ##   ..   malform = col_double(),
    ##   ..   menarche = col_double(),
    ##   ..   mheight = col_double(),
    ##   ..   momage = col_double(),
    ##   ..   mrace = col_double(),
    ##   ..   parity = col_double(),
    ##   ..   pnumlbw = col_double(),
    ##   ..   pnumsga = col_double(),
    ##   ..   ppbmi = col_double(),
    ##   ..   ppwt = col_double(),
    ##   ..   smoken = col_double(),
    ##   ..   wtgain = col_double()
    ##   .. )
    ##  - attr(*, "problems")=<externalptr>

``` r
na_check <- birthweight_df[rowSums(is.na(birthweight_df)) > 0,]
na_check
```

    ## # A tibble: 0 × 20
    ## # … with 20 variables: babysex <dbl>, bhead <dbl>, blength <dbl>, bwt <dbl>,
    ## #   delwt <dbl>, fincome <dbl>, frace <dbl>, gaweeks <dbl>, malform <dbl>,
    ## #   menarche <dbl>, mheight <dbl>, momage <dbl>, mrace <dbl>, parity <dbl>,
    ## #   pnumlbw <dbl>, pnumsga <dbl>, ppbmi <dbl>, ppwt <dbl>, smoken <dbl>,
    ## #   wtgain <dbl>

``` r
rm(na_check)
```

Looks like I will want to convert a handful of variables like `babysex`,
`frace`, `malform`, and `mrace` to factors instead of numeric vectors.
And it doesn’t seem like there are any NA values to account for before
analysis.

``` r
birthweight_df <- 
  birthweight_df %>% 
  mutate(babysex = factor(babysex,
                          levels = c(1, 2),
                          labels = c("male", "female"))) %>% 
  mutate(frace = factor(frace,
                        levels = c(1, 2, 3, 4, 8, 9),
                        labels = c("White", "Black", "Asian", "Puerto Rican", "Other", "Unknown"))) %>% 
  mutate(malform = factor(malform,
                          levels = c(0, 1),
                          labels = c("abset", "present"))) %>% 
  mutate(mrace = factor(mrace,
                        levels = c(1, 2, 3, 4, 8),
                        labels = c("White", "Black", "Asian", "Puerto Rican", "Other")))
```

My proposed regression model for birthweight is based on hypothesized
factors. I hypothesize that the following factors will affect
birthweight:

-   `gaweeks`: gestational age in weeks - hypothesized to increase
    weight with greater age;
-   `malform`: presence of malformations that could affect weight -
    hypothesized to decrease weight;
-   `momage`: mother’s age at delivery (years) - hypothesized to
    decrease weight with greater mother age;
-   `wtgain`: mother’s weight gain during pregnancy (pounds) -
    hypothesized to increase birthweight with greater weight gain during
    pregnancy.

``` r
hyp_mod = lm(bwt ~ gaweeks + malform + momage + wtgain, data = birthweight_df)
main_fx_mod = lm(bwt ~ blength + gaweeks, data = birthweight_df)
interact_mod = lm(bwt ~ bhead + blength + babysex + (bhead * blength) + (bhead * babysex) + (bhead * blength * babysex), data = birthweight_df)

hyp_mod %>% broom::tidy()
```

    ## # A tibble: 5 × 5
    ##   term           estimate std.error statistic   p.value
    ##   <chr>             <dbl>     <dbl>     <dbl>     <dbl>
    ## 1 (Intercept)      241.      90.3       2.67  7.61e-  3
    ## 2 gaweeks           60.0      2.22     27.0   3.01e-148
    ## 3 malformpresent   -43.6    117.       -0.372 7.10e-  1
    ## 4 momage            14.8      1.80      8.21  2.83e- 16
    ## 5 wtgain             9.48     0.640    14.8   1.66e- 48

There are significant p-values here for some of my hypothesized
predictors. Particularly `gaweeks` and `wtgain` seem to have the most
statistically significant effects. Let’s look at some residuals for the
hypothesized model.

``` r
birthweight_df %>% 
  add_predictions(hyp_mod) %>% 
  add_residuals(hyp_mod) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  labs(x = "Predicted Birthweight (grams)", y = "Residual", title = "Hypothesized Model Predictions vs Residuals")
```

    ## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'

![](p8105_hw6_tlm2152_files/figure-gfm/residuals%20predictions%20and%20plotting-1.png)<!-- -->

Most of the residuals seem to be fairly evenly dispersed about 0,
however there are some rather large differences. For instance some
predicted birthweights of 2000 grams have a residual of over 1000 grams.
We also seem to have more positive residuals on the low end of our
predictions and more negative residuals towards the maximum prediction,
which might be concerning for this model. Let’s take a look at a couple
of others and compare root mean squared error (RMSE).

``` r
cv_df <- 
  crossv_mc(birthweight_df, 100) %>% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %>% 
  mutate(
    hyp_model      = map(.x = train, ~lm(bwt ~ gaweeks + malform + momage + wtgain, data = .x)),
    main_fx_model  = map(.x = train, ~lm(bwt ~ blength + gaweeks, data = .x)),
    interact_model = map(.x = train, ~lm(bwt ~ bhead + blength + babysex + (bhead * blength) + (bhead * babysex) + (bhead * blength * babysex), data = .x))
    ) %>% 
  mutate(
    rmse_hyp      = map2_dbl(.x = hyp_model, .y = test, ~rmse(model = .x, data = .y)),
    rmse_main_fx  = map2_dbl(.x = main_fx_model, .y = test, ~rmse(model = .x, data = .y)),
    rmse_interact = map2_dbl(.x = interact_model, .y = test, ~rmse(model = .x, data = .y))
    )
```

``` r
cv_df %>% 
  select(starts_with("rmse")) %>% 
  pivot_longer(
    everything(),
    names_to = "model",
    values_to = "rmse",
    names_prefix = "rmse_") %>% 
  mutate(model = fct_inorder(model)) %>% 
  ggplot(aes(x = model, y = rmse)) + geom_violin()
```

![](p8105_hw6_tlm2152_files/figure-gfm/plotting%20RMSE%20for%20each%20model-1.png)<!-- -->

Based on the plot above, it looks like the hypothesized model has a much
higher RMSE compared to the other two. This lends credence to the idea
of using model diagnostics and data-driven model-building processes
rather than using hypotheses alone.
